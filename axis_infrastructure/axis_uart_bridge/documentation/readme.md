# axis_uart_bridge 

Компонент для организации приема и передачи данных по протоколу UART. Позволяет работать на разных скоростях и с различной шириной шины c возможностью организации внутренней очереди данных. 

## generic-параметры

Название | Тип | Диапазон значений | Описание
---------|-----|-------------------|---------
UART_SPEED | integer | > 0 | Скорость UART в бод/с
FREQ_HZ | integer | > (UART_SPEED*4) | Частота CLK в Гц
N_BYTES | integer | > 0 | Размер шины данных в байтах
QUEUE_DEPTH | integer | >= 0 | Глубина внутренней очереди, при 0 - очереди нет
QUEUE_MEMTYPE | string | "auto", "block", "distributed", "ultra" | Тип используемой очереди, игнорируется при QUEUE_DEPTH = 0
UART_TX_REGISTER_LEN | integer | >= 0 | Длина каскада, через который пропускается сигнал от логики до пина
UART_RX_REGISTER_LEN | integer | >= 0 | Длина каскада для перезащелкивания сигнала от пина до логики

## порты 

### Control 

Название | Направление | Разрядность | Назначение 
---------|-------------|-------------|-----------
aclk | input | 1 | сигнал тактирования 
aresetn | input | 1 | сигнал сброса, активен при 0

### AXI-Stream 

#### Slave AXI-Stream 

Название | Направление | Разрядность | Назначение 
---------|-------------|-------------|-----------
S_AXIS_TDATA | input | N_BYTES*8 | шина данных 
S_AXIS_TVALID | input | 1 | шина валидных данных на входе
S_AXIS_TREADY | output | 1 | шина готовности компонента принимать данные

#### Master AXI-Stream 

Название | Направление | Разрядность | Назначение 
---------|-------------|-------------|-----------
M_AXIS_CLK | input | 1 | сигнал тактирования шины S_AXIS_*
M_AXIS_TDATA | output | N_BYTES*8 | шина данных 
M_AXIS_TVALID | output | 1 | шина валидных данных на выходе
M_AXIS_TREADY | input | 1 | шина готовности принимать данные


## Некоторые принципы работы компонента
- Компонент состоит из двух модулей:
1) `axis_uart_bridge_rx` - для приема данных по UART и передаче по шине AXI-Stream
2) `axis_uart_bridge_tx` - для приема данных по AXI-Stream и передаче по UART
- Компонент принимает и передает данные по UART
- Приемом и передачей занимаются отдельные модули. 
- Поддерживается только работа от одного CLK. Перехода по CLK-доменам внутри компонента не выполняется

## axis_uart_bridge_tx

Компонент осуществляет прием данных по шине AXI-Stream и передает их через UART, формируя необходимые последовательности. 
Режим передачи:
1) START
2) 8 бит данных
3) STOP

Компонент не поддерживает TKEEP Для AXI-Stream. Это значит, что нет возможности передать какие-либо отдельно взятые байты из шины, слово будет передано полностью. Разделения пакетами не осуществляется ввиду ненадобности. 

Длительность символа UART рассчитывается из выражения:
`CLOCK_DURATION = FREQ_HZ/UART_SPEED`

`FREQ_HZ` должен быть больше чем `UART_SPEED` в четыре раза. В противном случае, работоспособность не гарантируется. 

Работа компонента строится на конечном автомате. Список состояний и условия переходов представлены в таблице ниже

Текущее состояние | Следующее состояние | Условие перехода | Описание состояния
------------------|---------------------|------------------|-------------------
IDLE_ST | START_ST | Входная очередь не пуста | Состояние ожидания нового слова на передачу
START_ST | DATA_ST | Событие окончания передачи символа | Состояние передачи START-символа
DATA_ST | STOP_ST | Окончание передачи символа и счетчик переданных символов равен семи | Состояние передачи данных. В текущем состоянии передается не более одного байта данных
STOP_ST | START_ST | 1. Окончание передачи символа и количество переданных байт слова меньше чем количество байт в слове 2. Окончание передачи символа и входная очередь не пуста | Состояние передачи символа STOP

## axis_uart_bridge_rx

Компонент осуществляет прием данных по UART и передает их через шину AXI-Stream. 
Поддерживается режим передачи:
1) START
2) 8 бит данных
3) STOP

